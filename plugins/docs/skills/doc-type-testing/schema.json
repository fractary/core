{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://fractary.dev/schemas/docs/testing.schema.json",
  "title": "Testing Documentation Schema",
  "description": "Schema for testing/QA documentation with dual-format support (README.md + testing.json) - includes test plans, results, validation, and benchmarks",
  "type": "object",
  "required": ["test_suite_name", "test_type", "version"],
  "properties": {
    "test_suite_name": {
      "type": "string",
      "description": "Name of the test suite",
      "minLength": 1,
      "maxLength": 100,
      "pattern": "^[a-z0-9-]+$"
    },
    "test_type": {
      "type": "string",
      "description": "Type of testing",
      "enum": ["unit", "integration", "e2e", "performance", "validation", "qa", "acceptance", "regression", "smoke"]
    },
    "version": {
      "type": "string",
      "description": "Semantic version of the test suite",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "component": {
      "type": "string",
      "description": "Component or system under test"
    },
    "description": {
      "type": "string",
      "description": "Description of what this test suite validates"
    },
    "test_plan": {
      "type": "object",
      "description": "Test planning and specifications",
      "properties": {
        "objective": {
          "type": "string",
          "description": "What this test suite aims to validate"
        },
        "scope": {
          "type": "string",
          "description": "What is included/excluded from testing"
        },
        "test_cases": {
          "type": "array",
          "description": "Individual test cases",
          "items": {
            "type": "object",
            "required": ["id", "name", "expected_result"],
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique test case identifier (e.g., TC-001)",
                "pattern": "^TC-[0-9]{3,}$"
              },
              "name": {
                "type": "string",
                "description": "Test case name"
              },
              "type": {
                "type": "string",
                "enum": ["unit", "integration", "e2e", "performance", "validation"]
              },
              "priority": {
                "type": "string",
                "enum": ["critical", "high", "medium", "low"],
                "description": "Test case priority"
              },
              "procedure": {
                "type": "string",
                "description": "Step-by-step test procedure"
              },
              "preconditions": {
                "type": "array",
                "description": "Prerequisites before running test",
                "items": {
                  "type": "string"
                }
              },
              "test_data": {
                "type": "object",
                "description": "Test data requirements or samples"
              },
              "expected_result": {
                "type": "string",
                "description": "What should happen when test passes"
              },
              "assertions": {
                "type": "array",
                "description": "Specific assertions to validate",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "coverage_requirements": {
          "type": "object",
          "description": "Code coverage requirements",
          "properties": {
            "minimum_line_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Minimum line coverage percentage"
            },
            "minimum_branch_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Minimum branch coverage percentage"
            },
            "minimum_function_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "test_results": {
      "type": "object",
      "description": "Test execution results",
      "properties": {
        "execution_id": {
          "type": "string",
          "description": "Unique execution identifier (e.g., run-20250115-143022)"
        },
        "execution_timestamp": {
          "type": "string",
          "description": "When tests were executed",
          "format": "date-time"
        },
        "environment": {
          "type": "string",
          "enum": ["local", "ci", "staging", "prod", "test"],
          "description": "Environment where tests ran"
        },
        "executed_by": {
          "type": "string",
          "description": "Who/what executed the tests (CI pipeline, manual, etc.)"
        },
        "summary": {
          "type": "object",
          "required": ["total_tests", "passed", "failed"],
          "properties": {
            "total_tests": {
              "type": "integer",
              "minimum": 0
            },
            "passed": {
              "type": "integer",
              "minimum": 0
            },
            "failed": {
              "type": "integer",
              "minimum": 0
            },
            "skipped": {
              "type": "integer",
              "minimum": 0
            },
            "pass_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Percentage of tests that passed"
            }
          }
        },
        "test_case_results": {
          "type": "array",
          "description": "Results for each test case",
          "items": {
            "type": "object",
            "required": ["test_id", "status"],
            "properties": {
              "test_id": {
                "type": "string",
                "description": "References test_plan.test_cases[].id"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "fail", "skip", "error"]
              },
              "duration_ms": {
                "type": "number",
                "description": "Test execution time in milliseconds"
              },
              "actual_result": {
                "type": "string",
                "description": "What actually happened"
              },
              "error_message": {
                "type": "string",
                "description": "Error message if test failed"
              },
              "stack_trace": {
                "type": "string",
                "description": "Stack trace for failures"
              },
              "screenshots": {
                "type": "array",
                "description": "Screenshots or artifacts from test",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "coverage_achieved": {
          "type": "object",
          "description": "Code coverage metrics achieved",
          "properties": {
            "line_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "branch_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "function_coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "uncovered_areas": {
              "type": "array",
              "description": "Files or lines not covered",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "performance_metrics": {
          "type": "object",
          "description": "Test execution performance",
          "properties": {
            "total_duration": {
              "type": "string",
              "description": "Total test suite runtime (e.g., '5m 32s')"
            },
            "avg_test_duration": {
              "type": "string",
              "description": "Average per-test runtime"
            },
            "slowest_tests": {
              "type": "array",
              "description": "List of slowest tests",
              "items": {
                "type": "object",
                "properties": {
                  "test_id": {
                    "type": "string"
                  },
                  "duration_ms": {
                    "type": "number"
                  }
                }
              }
            }
          }
        }
      }
    },
    "validation_steps": {
      "type": "object",
      "description": "Validation procedures (separate from automated tests)",
      "properties": {
        "pre_deployment_validation": {
          "type": "array",
          "description": "Validation checks before deployment",
          "items": {
            "type": "object",
            "required": ["step", "validation_name"],
            "properties": {
              "step": {
                "type": "integer",
                "description": "Validation step number"
              },
              "validation_name": {
                "type": "string",
                "description": "Name of this validation"
              },
              "procedure": {
                "type": "string",
                "description": "How to perform this validation"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "fail", "pending", "n/a"]
              },
              "result": {
                "type": "string",
                "description": "Validation result details"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "post_deployment_validation": {
          "type": "array",
          "description": "Validation checks after deployment",
          "items": {
            "type": "object",
            "required": ["step", "validation_name"],
            "properties": {
              "step": {
                "type": "integer"
              },
              "validation_name": {
                "type": "string"
              },
              "procedure": {
                "type": "string"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "fail", "pending", "n/a"]
              },
              "result": {
                "type": "string"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "data_validation": {
          "type": "array",
          "description": "Data integrity and quality validation",
          "items": {
            "type": "object",
            "required": ["validation_name", "expected"],
            "properties": {
              "validation_name": {
                "type": "string"
              },
              "query": {
                "type": "string",
                "description": "SQL query or data check"
              },
              "expected": {
                "type": "string",
                "description": "Expected result or threshold"
              },
              "actual": {
                "type": "string",
                "description": "Actual result"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "fail", "pending"]
              }
            }
          }
        }
      }
    },
    "qa_process": {
      "type": "object",
      "description": "QA processes and quality gates",
      "properties": {
        "quality_gates": {
          "type": "array",
          "description": "Quality gates that must pass",
          "items": {
            "type": "object",
            "required": ["gate", "required"],
            "properties": {
              "gate": {
                "type": "string",
                "description": "Quality gate description"
              },
              "required": {
                "type": "boolean",
                "description": "Is this gate required to pass?"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "fail", "pending"]
              },
              "details": {
                "type": "string"
              }
            }
          }
        },
        "review_checklist": {
          "type": "array",
          "description": "Manual review checklist items",
          "items": {
            "type": "object",
            "properties": {
              "item": {
                "type": "string"
              },
              "completed": {
                "type": "boolean"
              },
              "reviewed_by": {
                "type": "string"
              }
            }
          }
        },
        "acceptance_criteria": {
          "type": "array",
          "description": "Criteria for accepting the change",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "performance_benchmarks": {
      "type": "object",
      "description": "Performance benchmarking and regression detection",
      "properties": {
        "baseline_metrics": {
          "type": "object",
          "description": "Baseline performance metrics",
          "additionalProperties": {
            "type": ["string", "number"]
          }
        },
        "current_metrics": {
          "type": "object",
          "description": "Current performance metrics",
          "additionalProperties": {
            "type": ["string", "number"]
          }
        },
        "regression_threshold": {
          "type": "string",
          "description": "Acceptable performance degradation (e.g., '5%')"
        },
        "benchmark_status": {
          "type": "string",
          "enum": ["pass", "regression_detected", "improvement"],
          "description": "Overall benchmark status"
        },
        "benchmark_details": {
          "type": "array",
          "description": "Detailed benchmark comparisons",
          "items": {
            "type": "object",
            "properties": {
              "metric": {
                "type": "string"
              },
              "baseline": {
                "type": "number"
              },
              "current": {
                "type": "number"
              },
              "change_percentage": {
                "type": "number"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "regression", "improvement"]
              }
            }
          }
        }
      }
    },
    "test_environment": {
      "type": "object",
      "description": "Test environment configuration",
      "properties": {
        "infrastructure": {
          "type": "string",
          "description": "Infrastructure setup (e.g., 'AWS ECS', 'local Docker')"
        },
        "dependencies": {
          "type": "array",
          "description": "Required services and versions",
          "items": {
            "type": "string"
          }
        },
        "test_data_location": {
          "type": "string",
          "description": "Where test data is stored"
        },
        "configuration": {
          "type": "object",
          "description": "Environment-specific configuration"
        }
      }
    },
    "references": {
      "type": "object",
      "description": "References to code and related resources",
      "properties": {
        "test_code_repository": {
          "type": "string",
          "description": "Git repository for test code"
        },
        "ci_pipeline": {
          "type": "string",
          "description": "CI/CD pipeline URL",
          "format": "uri"
        },
        "related_docs": {
          "type": "array",
          "description": "Links to related documentation",
          "items": {
            "type": "string"
          }
        },
        "test_reports": {
          "type": "array",
          "description": "Historical test report URLs",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "contacts": {
      "type": "object",
      "description": "Team and contact information",
      "properties": {
        "owner": {
          "type": "string",
          "description": "QA team or person responsible"
        },
        "reviewers": {
          "type": "array",
          "description": "People who review test results",
          "items": {
            "type": "string"
          }
        },
        "slack_channel": {
          "type": "string"
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "Tags for categorization",
      "items": {
        "type": "string"
      }
    },
    "created": {
      "type": "string",
      "description": "Creation timestamp",
      "format": "date-time"
    },
    "updated": {
      "type": "string",
      "description": "Last update timestamp",
      "format": "date-time"
    }
  }
}
